<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{board_layout :: layout(~{::title}, ~{::content})}">
<head>
    <meta charset="UTF-8">
    <title>웹툰 목록</title>
</head>
<body>

<section id="webtoon-list" class="position-relative padding-small">

<!--    수정필요-->
    <div id="filter-options">
        <a th:href="@{/wt_selectAll(filter='all')}" class="filter-option"
           th:classappend="${filter == null || filter == 'all'} ? 'selected-option' : ''">전체</a>
        <a th:href="@{/wt_selectAll(filter='recommend')}" class="filter-option"
           th:classappend="${filter == 'recommend'} ? 'selected-option' : ''">사용자 추천</a>
        <a th:href="@{/wt_selectAll(filter='prefer')}" class="filter-option"
           th:classappend="${filter == 'prefer'} ? 'selected-option' : ''">선호</a>
    </div>


<!--    필터링 태그 디자인 수정 필요-->
    <div >
    <span  class="category" th:each="category : ${categories}" th:if="${category != null}"
          th:text="'#' + ${category}" th:data-category="${category}" onclick="filterByCategory(this)"></span>
    </div>

    <!-- 검색 폼 -->
    <div id="filter-container">
        <form class="webtoon-search" action="/wt_search" method="get">
            <input type="hidden" name="category" th:value="${category}"/> <!-- 선택된 카테고리 유지 -->
            <input type="hidden" name="sortOrder" th:value="${sortOrder}"/> <!-- 선택된 정렬 방식 유지 -->
            <select name="searchType">
                <option value="title">제목</option>
                <option value="writer">작가</option>
                <option value="categories">장르</option>
            </select>
            <input type="text" name="searchWord" placeholder="Search..." th:value="${searchWord}"/>
            <input type="image" src="/img/book_webnovel_search.png" alt="Search" class="search-icon"/>
        </form>

        <div id="sort-options">
            <a th:href="@{/wt_selectAll}"
               th:classappend="${searchType == 'null'} ? 'selected-sort' : 'sort-option'">전체보기</a>

            <a th:href="@{/wt_search(searchType='popular')}"
               th:classappend="${searchType == 'popular'} ? 'selected-sort' : 'sort-option'">인기순</a>
        </div>
    </div>


    <div class="webtoon-grid">
        <div class="webtoon-item" th:each="webtoon : ${webtoonList}">
            <a th:href="@{/wt_selectOne(item_id=${webtoon.item_id})}">
                <img th:src="@{${webtoon.img_name}}" class="webtoon-img" alt="Webtoon Cover">
            </a>
            <a th:href="@{/wt_selectOne(item_id=${webtoon.item_id})}" class="webtoon-title"
               th:text="${webtoon.title}"></a>
        </div>
        <form action="/bookshelf/insertOK" method="post">
            <div class="card-concern position-absolute start-0 end-0 vstack gap-2 p-2">
                <input type="hidden" name="work_num" th:value="${webtoon.item_id}" />
                <label th:for="'read'+${webtoon.item_id}" class="btn btn-dark"><input type="radio" name="sort" th:id="'read'+${webtoon.item_id}" value="read" onchange="this.form.submit()" class="position-absolute"> 읽은 작품</label>
                <label th:for="'to-read'+${webtoon.item_id}" class="btn btn-dark"><input type="radio" name="sort" th:id="'to-read'+${webtoon.item_id}" value="to-read" onchange="this.form.submit()" class="position-absolute"> 읽고 싶은 작품</label>
                <label th:for="'ing'+${webtoon.item_id}" class="btn btn-dark"><input type="radio" name="sort" th:id="'ing'+${webtoon.item_id}" value="ing" onchange="this.form.submit()" class="position-absolute"> 읽고 있는 작품</label>
            </div>
        </form>
    </div>


    <!-- 페이징 기능 추가 -->
    <div class="pagination">
        <ul class="pagination">
            <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/wt_search(page=${currentPage - 1}, searchType=${searchType}, searchWord=${searchWord})}">이전</a>
            </li>
            <li class="page-item" th:each="pageNum : ${#numbers.sequence(startPage, endPage)}"
                th:classappend="${pageNum == currentPage} ? 'active'">
                <a class="page-link"
                   th:href="@{/wt_search(page=${pageNum}, searchType=${searchType}, searchWord=${searchWord})}"
                   th:text="${pageNum}">1</a>
            </li>
            <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/wt_search(page=${currentPage + 1}, searchType=${searchType}, searchWord=${searchWord})}">다음</a>
            </li>
        </ul>
    </div>

</section>
</body>
</html>