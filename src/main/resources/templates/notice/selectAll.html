<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:fragment="layout(title, content)">
<head>
  <title th:text="${title}">PageOn</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"/>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/sub.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>공지사항</title>
  <style>
    .table-header {
      font-weight: 550; /* 400은 일반보다 덜 굵게 */
    }
  </style>
</head>

<body>
<header th:replace="~{header :: header}"></header>

<section class="container mt-5">
  <h3>공지사항 페이지</h3>
  <br>

  <form class="d-flex justify-content-end" onsubmit="return validateForm()" action="/notice/n_searchList.do" style="margin-bottom: 1rem;">
    <select id="input2" name="searchKey" class="form-select form-select-sm me-0" style="width: auto; border-radius: 0; height: 45px; font-size: 1rem;">
      <option value="title">제목</option>
      <option value="content">내용</option>
    </select>
    <input id="input1" type="text" name="searchWord" class="form-control form-control-sm me-0" placeholder="검색어를 입력하세요" style="width: 300px; font-size: 1rem; height: 45px; border-radius: 0;">
    <input class="btn btn-outline-primary btn-dark rounded-0 p-2" id="search" type="submit" value="검색" style="width: auto; height: 45px; font-size: 1rem; border-radius: 0;">
  </form>

  <div class="card p-4">
    <table class="table table-bordered table-hover w-100">
      <form class="text-start" style="margin-bottom: 1rem;" action="/notice/n_selectAll.do" method="get">
        <div style="display: flex; align-items: center;">
          <select name="sort" id="sort" class="form-select form-select-sm w-auto" style="font-size: 1rem;" onchange="this.form.submit()">
            <option value="newest" th:selected="${currentSort == 'newest'}">최신순</option>
            <option value="oldest" th:selected="${currentSort == 'oldest'}">오래된순</option>
            <option value="mostViewed" th:selected="${currentSort == 'mostViewed'}">조회순</option>
          </select>
          <input type="hidden" name="cpage" value="1"/>
        </div>
      </form>
      <br>

      <thead class="text-center">
      <tr>
        <th class="table-header">글번호</th>
        <th class="table-header">제목</th>
        <th class="table-header">작성자</th>
        <th class="table-header">조회수</th>
        <th class="table-header">작성일자</th>
      </tr>
      </thead>

      <tbody>
      <tr th:each="notice_list : ${list}" style="cursor:pointer;" th:onclick="|location.href='/notice/n_selectOne.do?num=${notice_list.num}'|">
        <td class="text-center">[[${notice_list.num}]]</td>
        <td class="text-center">[[${notice_list.title}]]</td>
        <td class="text-center" th:text="${notice_list.user_id}"></td>
        <td class="text-center" th:text="${notice_list.hitcount}"></td>
        <td class="text-center" th:text="${notice_list.wdate}"></td>
      </tr>
      </tbody>
    </table>

    <!-- 페이지네이션 링크를 포함하는 div를 테이블 아래에 추가 -->
    <div class="text-center mt-3">
      <th:block th:each="i : ${#numbers.sequence(1, totalPageCount)}">
        <a th:href="|/notice/n_selectAll.do?cpage=${i}&sort=${currentSort}|">[[${i}]]</a>
      </th:block>
    </div>
  </div>

  <!-- 글쓰기 버튼을 테이블 오른쪽 끝에 배치 -->
  <div class="d-flex justify-content-end mt-3">
    <form action="/notice/n_insert.do">
      <input class="btn btn-dark" type="submit" value="작성하기" style="font-size: 1em">
    </form>
  </div>
</section>

<footer th:replace="~{footer :: footer}"></footer>

<script>
  function getByteLength(text) {
    let byteSize = 0;
    for (let i = 0; i < text.length; i++) {
      const charCode = text.charCodeAt(i);
      byteSize += charCode <= 0x007F ? 1 : charCode <= 0x07FF ? 2 : 3; // ASCII는 1바이트, 나머지 유니코드는 2~3바이트
    }
    return byteSize;
  }

  function validateForm() {
    const searchWord = document.getElementById("input1").value;

    if (getByteLength(searchWord) > 100) {
      alert("검색어가 100바이트를 초과하였습니다.");
      return false;
    }
    if (getByteLength(searchWord) <= 0) {
      alert("검색어를 입력하세요.");
      return false;
    }

    return true; // 모든 조건을 만족하면 폼을 제출
  }
</script>

<script src="/js/jquery-1.11.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
<script type="text/javascript" src="/js/common.js"></script>

</body>
</html>
